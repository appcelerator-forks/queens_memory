function __processArg(e,t){var i=null;return e&&(i=e[t]||null,delete e[t]),i}function Controller(){function e(){var e=r.getView();e.right="-100%",e.left="100%",e.animate({duration:"300",left:0,right:0}),Ti.API.info("OPEN MENU"),r.menuState=u.EXPANDED}function t(){var e=r.getView();e.animate({duration:"300",left:"100%",right:"-100%"}),Ti.API.info("CLOSE MENU"),r.menuState=u.COLLAPSED}function i(e){"right"==e.direction&&t()}function o(e){_.each(h,function(t){Ti.API.info("Registering "+t.getId()),Alloy.Globals.offlineControllers.indexOf(t.getId())<0&&(e.online?t.enable():t.disable())})}if(require("/alloy/controllers/BaseController").apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath="menu",this.args=arguments[0]||{},arguments[0]){__processArg(arguments[0],"__parentSymbol"),__processArg(arguments[0],"$model"),__processArg(arguments[0],"__itemTemplate")}var r=this,n={},s={};r.__views.index=Ti.UI.createView({top:0,width:"100%",height:Ti.UI.FILL,zIndex:10,backgroundColor:"transparent",modal:!0,left:"100%",right:"-100%",id:"index"}),r.__views.index&&r.addTopLevelView(r.__views.index),r.__views.flyoutContainer=Ti.UI.createView({top:0,width:"80%",right:0,backgroundColor:"#723582",height:Ti.UI.SIZE,opacity:.8,layout:"vertical",id:"flyoutContainer"}),r.__views.index.add(r.__views.flyoutContainer),i?r.addListener(r.__views.flyoutContainer,"swipe",i):s["$.__views.flyoutContainer!swipe!onSwipe"]=!0,r.__views.menuContainer=Ti.UI.createScrollView({top:"0dp",width:"100%",right:"0dp",height:Ti.UI.FILL,backgroundColor:"transparent",layout:"vertical",scrollingEnabled:!0,scrollType:"vertical",id:"menuContainer"}),r.__views.flyoutContainer.add(r.__views.menuContainer),n.destroy=function(){},_.extend(r,r.__views);var a,l,d=require("menuLib"),h=[];const u={COLLAPSED:0,EXPANDED:1};r.menuState=u.COLLAPSED;var c,f=d.menuItemsArray;r.closeMenu=t,r.toggleMenu=function(){Ti.API.info("MENU IS "+r.menuState),r.menuState==u.COLLAPSED?(Ti.API.info("OPEN MENU"),e()):(Ti.API.info("CLOSE MENU"),t())},r.resetMenu=function(){r.menuContainer.removeAllChildren(),_.each(c,function(e,t){var i;i=!!Ti.Network.getOnline()||Alloy.Globals.offlineControllers.indexOf(e.id)>=0;var o=Alloy.createController("handheld/menuItem",{parent:r,index:t,item:e,enabled:i});e.separator===!0&&o.setIsSeparator(!0),r.menuContainer.add(o.getView()),h.push(o),_.each(h,function(e){e.showTitle()})});var e=Alloy.createController("handheld/buildMenuItem",{parent:r});e.setVersion(Ti.App.version+" - "+Alloy.Globals.ENV),r.menuContainer.add(e.getView())},r.resetMenu(),f=_.sortBy(f,function(e){return e.index}),r.setParentController=function(e){l=e},r.onMenuItemChange=function(e){if(Ti.App.fireEvent("app.navigation.event",{fromStr:"HomeMenu",toStr:c[e].title}),r.menuState===u.COLLAPSED?Ti.API.info("Menu is COLLAPSED"):r.menuState===u.EXPANDED&&Ti.API.info("Menu is EXPANDED"),(!(Alloy.Globals.offlineControllers.indexOf(c[e].id)<0)||Alloy.Globals.checkOnline())&&(Ti.API.info("Load landing window for current selection > "+c[e].landing),c[e].landing)){if("login"===c[e].landing){var i=Alloy.createController("handheld/login",{success:loginLib.userAuthenticated,parent:l});i.isModal=!0,i.headerBackgroundColor="#EBEBEB",i.headerTitle="LOGIN TO YOUR ACCOUNT",l.openWindow(i,"__LOG")}else if("terms"===c[e].landing){var o=Alloy.createController("handheld/browser",{parentController:r,url:"http://m.queenslibrary.org/about-us/copyright-disclaimer",partnerUrl:!0,hideNavArrows:!0});o.open(!1)}else if("contactUs"===c[e].landing){var o=Alloy.createController("handheld/browser",{parentController:r,url:("QA"===Alloy.Globals.ENV?"http://mqa":"http://m")+".queenslibrary.org/contact-us",partnerUrl:!1,hideNavArrows:!0});o.open()}else if("donate"===c[e].landing){Alloy.Globals.sendAdobeTrackState("Donate");var o;Ti.Platform.openURL("http://foundation.queenslibrary.org/give-now/?mydevice=apple")}else if("landing"===c[e].landing)l.getWindowManager().clear();else if("logout"===c[e].landing)l.header.loginLogout();else if("__EBO"===c[e].id)if(Alloy.Globals.holdsChecked)l.openWindow("handheld/"+c[e].landing,c[e].id);else{var n=require("commonLibraries/ebooksCommonLib");activityWindow.show("Checking User\nHolds"),n.setUserHolds().then(function(){activityWindow.hide(),l.openWindow("handheld/"+c[e].landing,c[e].id)})}else if(l)l.getWindowManager().clear(),l.openWindow("handheld/"+c[e].landing,c[e].id);else{var o=Alloy.createController("handheld/main",{action:"handheld/"+c[e].landing,landing:r});o.getView().open()}t()}},r.currentSelectedItem=function(){return a},r.onSwipe=i,Titanium.Network.addEventListener("change",o),r.index.addEventListener("click",function(){t()}),Ti.App.addEventListener("app.change.env.done",r.resetMenu),s["$.__views.flyoutContainer!swipe!onSwipe"]&&r.addListener(r.__views.flyoutContainer,"swipe",i),_.extend(r,n)}var Alloy=require("/alloy"),Backbone=Alloy.Backbone,_=Alloy._;module.exports=Controller;